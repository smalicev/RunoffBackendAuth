(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4627:function(e,t,n){Promise.resolve().then(n.bind(n,5259))},5259:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return D}});var i=n(3827),r=n(197),a=n(345),s=n.n(a),l=n(4090);function o(e){let[t,n]=(0,l.useState)(!1),r=t?{backgroundColor:"rgba(0, 255, 179, 0.216)",borderRadius:e.style?e.style.borderRadius:void 0,boxShadow:e.style?e.style.boxShadow:void 0}:void 0;return(0,i.jsx)("div",{onMouseEnter:function(){n(!0)},onMouseLeave:function(){n(!1)},style:r,children:e.children})}function c(e){let{totals:t,firstChild:n,secondChild:r}=e,a={display:"flex",flexDirection:"column",rowGap:"1rem",justifyContent:"flex-start",height:"100vh",backgroundColor:"var(--main-bg-color)",padding:"2rem",boxShadow:"rgba(0, 0, 0, 0.25) 0px 14px 28px, rgba(0, 0, 0, 0.22) 0px 10px 10px",ul:{display:"flex",flexDirection:"column",listStyleType:"none",rowGap:"1rem"}};return(0,i.jsx)("div",{children:(0,i.jsxs)("nav",{style:a,children:[(0,i.jsx)("div",{className:"sidebar-name-container",children:(0,i.jsx)("h1",{children:"Catchment Runoff Calculator"})}),(0,i.jsxs)("ul",{style:a.ul,children:[(0,i.jsx)(o,{children:(0,i.jsx)("h3",{children:"Schematic View"})}),(0,i.jsx)(o,{children:(0,i.jsx)("h3",{children:"Documentation"})})]}),(0,i.jsx)("h4",{children:"Tools"}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"row",rowGap:"1rem",justifyContent:"space-around",padding:"1rem",borderTop:"2px solid rgba(92, 92, 92, 0.404)"},children:[n||null,r||null]})]})})}var d=n(703),u=n(7615);function h(e){let{attributes:t,listeners:n,setNodeRef:r,transform:a}=(0,u.O1)({id:e.id}),s=a?{transform:"translate3d(".concat(a.x,"px, ").concat(a.y,"px, 0)")}:void 0;return(0,i.jsx)("div",{ref:r,style:s,...n,...t,children:e.children})}class m{valuesToIntensity(e){let t=[];return console.log(this.storm.cumulativePrecipitation),e.forEach((e,n)=>{t.push(e/(this.timeStep/60))}),t}calcKinematicWaveK(){let e=Math.max(...this.storm.precipitationDataIntensity);return console.log(e),this.catchment.flowLength**.6*this.catchment.roughnessCoeff**.6/(e**.4*(this.catchment.slopePercent/100)**.3)}scsLosses(e){let t=[],n=this.catchment.sParameter;return e.forEach((e,i)=>{t.push((e-.2*n)**2/(e+.8*n))}),t}linearIUH(){return{prePeakFlowFunc:e=>this.storm.timeStep/this.storm.timeStep*e,peakFlowFunc:e=>(e-Math.exp(-(this.storm.timeStep/this.kinematicWaveK)))/this.storm.timeStep,postPeakFlowFunc:(e,t)=>e*Math.exp(-(t-this.storm.timeStep)/this.kinematicWaveK)}}convolute(e){let t,n=[];return this.effectiveRunoff.forEach((t,i)=>{let r={},a=this.timeStep;r[this.timeStep*(i+1)]=e.peakFlowFunc(t);let s=0;for(console.log(e.peakFlowFunc(t)+"peak flow");e.postPeakFlowFunc(t,a)>.005&&s<1e3;)s++,r[a+this.timeStep*(i+1)]=e.postPeakFlowFunc(t,a+this.timeStep),a+=this.timeStep;n.push(r)}),console.log(n),t={},n.forEach((e,n)=>{for(let n in e)void 0===t[n]?t[n]=e[n]:t[n]+=e[n]}),t}generateTimeSeriesandIncRunoff(){for(let e in this.finalRunoffTimeSeries=[0],this.finalRunoffIncremental=[0],this.convolutions)this.finalRunoffTimeSeries.push(e),this.finalRunoffIncremental.push(this.convolutions[e]/100*this.catchment.areaHectares*1e4/(60*this.storm.timeStep))}constructor(e=null,t,n){this.timeStep=t.timeStep,this.timeToPeak=this.timeStep,this.storm=t,this.catchment=n,this.kinematicWaveK=this.calcKinematicWaveK(),this.effectiveRunoff=function(e){let t=[];for(let n=e.length-1;n>0;n--)t.push(e[n]-e[n-1]);return t.push(e[0]),t.reverse()}(this.scsLosses(this.storm.cumulativePrecipitation)),this.finalRunoffIncremental=null,this.finalRunoffTimeSeries=null,this.convolutions=this.convolute(this.linearIUH()),this.name="".concat(t.name," on ").concat(n.name),this.generateTimeSeriesandIncRunoff(),this.id=e,this.totalRunoff=this.storm.precipitationData.reduce((e,t)=>e+t)/1e3*(1e4*this.catchment.areaHectares),this.totalLosses=this.effectiveRunoff.reduce((e,t)=>e+t)/1e3*(1e4*this.catchment.areaHectares)}}var p={src:"/Dashboard/hydrosim/appl//_next/static/media/catchment.c866e452.svg",height:630,width:630,blurWidth:0,blurHeight:0};function x(e){let{style:t}=e;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(d.default,{"data-type":"catchment",src:p,height:100,width:100,alt:"A logo of an urban street with buildings and other infrastructure",style:t})})}var f={src:"/Dashboard/hydrosim/appl//_next/static/media/storm.c2b018f6.svg",height:630,width:630,blurWidth:0,blurHeight:0};function g(e){let{style:t}=e;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(d.default,{"data-type":"storm",src:f,height:100,width:100,alt:"A logo of a cloud with rainfall",style:t})})}function b(e){let{isOver:t,setNodeRef:n}=(0,u.Zj)({id:e.id}),[r,a]=(0,l.useState)(null),o=e.currentStorm,c=e.currentCatchment,d=e.draggableCurrentStorm,h=e.draggableCurrentCatchment;return(0,l.useMemo)(()=>void(null!==o&&null!==c&&a(new m(0,o,c))),[o,c]),(0,l.useMemo)(()=>e.func(r),[r]),(0,i.jsx)("div",{ref:n,style:{border:t?"0.25rem solid rgba(0, 0, 0, .05)":void 0,backgroundColor:t?"rgba(0, 0, 0, .3)":void 0,borderRadius:"1rem"},children:(0,i.jsxs)("div",{className:s().hydrographContainer,children:[(0,i.jsxs)("div",{className:s().catchmentSlot,children:[" ",h||(0,i.jsx)(x,{style:{opacity:.5,borderRadius:"50%",boxShadow:"0 0 10px 5px gray"}})]}),(0,i.jsxs)("div",{className:s().stormSlot,children:[" ",d||(0,i.jsx)(g,{style:{opacity:.5,border:"solid 1px gray",borderRadius:"50%",boxShadow:"0 0 10px 5px gray"}})]}),c&&o?(0,i.jsxs)("div",{className:s().textSlot,children:[o.name," on ",(0,i.jsx)("br",{})," the ",c.name," catchment."]}):(0,i.jsxs)("div",{className:s().textSlot,children:["Runoff Hydrograph ",(0,i.jsx)("br",{}),"  ",(0,i.jsx)("br",{})," Drag & drop both catchment and storm icons to get started!"]})]})})}class y{intensityToValues(e){let t=[];return e.forEach((e,n)=>{t.push(this.timeStep/60*e)}),t}constructor(e=null,t,n=[0,15,30,45,60,75,90,105,120,135,150,165,180],i=[5,8,12,55,74,112,78,56,55,32,4,2,1]){var r;let a;this.timeData=n,this.timeStep=n[1]-n[0],this.precipitationDataIntensity=i,this.precipitationData=this.intensityToValues(this.precipitationDataIntensity),this.cumulativePrecipitation=(r=this.precipitationData,a=[],r.forEach((e,t)=>{let n=0;for(let e=0;e<=t;e++)n+=r[e];a.push(n)}),a),this.name=t,this.id=e}}class S{constructor(e=null,t,n=1,i=30,r=1,a=85,s=40){this.name=t,this.areaHectares=n,this.imperviousPercent=i,this.slopePercent=r,this.curveNumber=a,this.sParameter=1e3/a+10,this.flowLength=s,this.roughnessCoeff=this.imperviousPercent<=20?.013:.25,this.timeToPeak=this.imperviousPercent<=20?null:this.kinematicWaveK,this.id=e}}var v=n(6136),j=n(1196);function w(e){let{chartData:t,header:n}=e;return(0,i.jsxs)("div",{className:"chart-container",children:[(0,i.jsxs)("h2",{style:{textAlign:"center"},children:[" ",n]}),(0,i.jsx)(j.x1,{data:t,options:{responsive:!0,scales:{x:{title:{display:!0,text:"Time (minutes)"}},y:{title:{display:!0,text:"Runoff (m\xb3/s)"},min:0}},plugins:{legend:{position:"top"},title:{display:!0,text:"Simulated hydrograph based on the current catchment and storm"}}}})]})}function _(e){let{chartData:t,header:n}=e;return(0,i.jsxs)("div",{className:"chart-container",children:[(0,i.jsxs)("h2",{style:{textAlign:"center"},children:[" ",n]}),(0,i.jsx)(j.by,{data:t,options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Total Volumetric Runoff (m\xb3)"}}}})]})}function C(e){let{editingObject:t,editSubmission:n}=e,r=t?Object.keys(t):null,a=t?Object.values(t):null,s=["cumulativePrecipitation","timeStep","roughnessCoeff","sParameter","timeToPeak","id","precipitationData"],l={precipitationDataIntensity:"Precipitation (intensity - mm/hr)",timeData:"Time series (minutes)",name:"Name or description",areaHectares:"Area (hectares)",imperviousPercent:"Percent Impervious (%)",slopePercent:"Slope Percent (%)",curveNumber:"SCS Curve Number",flowLength:"Flow length (m)"},o={fontSize:"1.25rem"};return(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",rowGap:"1rem",padding:"2rem",border:"2px solid rgba(92, 92, 92, 0.404)",boxShadow:"rgba(0, 0, 0, 0.25) 0px 14px 28px, rgba(0, 0, 0, 0.22) 0px 10px 10px"},className:"edit-menu",children:[(0,i.jsxs)("h2",{children:["Editing ",t.name]}),(0,i.jsxs)("form",{style:{display:"flex",flexDirection:"column",rowGap:"1rem",textAlign:"right",fontSize:"1.25rem"},children:[r.map((e,t)=>{if(!s.includes(e))return(0,i.jsxs)("label",{children:[l[e],": ",(0,i.jsx)("input",{style:o,name:e,defaultValue:a[t]},e)]},e)}),(0,i.jsx)("button",{style:{padding:"1rem",alignSelf:"right",fontSize:"1.5rem"},onClick:n,type:"button",children:" Submit Edits and Recalculate "})]})]})}function N(e){let{contextObject:t,mousePosition:n,editOnClick:r,deleteOnClick:a}=e,s={top:n.y,left:n.x,zIndex:10,position:"absolute",backgroundColor:"var(--main-bg-color)",padding:"0.5rem",fontSize:"1.5rem"},l={borderTop:"solid 1px rgba(92, 92, 92, 0.404)",borderBottom:"solid 1px rgba(92, 92, 92, 0.404)"};return t?(0,i.jsx)("div",{style:s,children:(0,i.jsxs)("ul",{style:{listStyleType:"none"},children:[(0,i.jsx)(o,{children:(0,i.jsxs)("li",{style:l,className:"contextMenu edit",children:["Edit ",t.name]})}),(0,i.jsx)(o,{children:(0,i.jsxs)("li",{style:l,className:"contextMenu delete",children:["Delete ",t.name]})})]})}):null}function R(){let[e,t]=(0,l.useState)(0),[n,r]=(0,l.useState)(0),[a,d]=(0,l.useState)(null),[m,p]=(0,l.useState)(!1),[f,v]=(0,l.useState)(null),[j,R]=(0,l.useState)(null),[P,D]=(0,l.useState)(null),[k,T]=(0,l.useState)(!1),[I,E]=(0,l.useState)(!1),[F,O]=(0,l.useState)({x:null,y:null});(0,l.useEffect)(()=>{let e=localStorage.getItem("currentStorm"),t=localStorage.getItem("currentCatchment");console.log(e),e&&v(JSON.parse(e)),t&&R(JSON.parse(t))},[]);let H=(0,l.useRef)({}),L=(0,i.jsx)(h,{id:"addCatchment",children:(0,i.jsx)(o,{style:{borderRadius:"10%",boxShadow:"rgba(0, 0, 0, 0.25) 0px 14px 28px, rgba(0, 0, 0, 0.22) 0px 10px 10px"},children:(0,i.jsx)(x,{style:{borderRadius:"50%",zIndex:15}})})}),M=(0,i.jsx)(h,{id:"addStorm",children:(0,i.jsx)(o,{style:{borderRadius:"10%",boxShadow:"rgba(0, 0, 0, 0.25) 0px 14px 28px, rgba(0, 0, 0, 0.22) 0px 10px 10px"},children:(0,i.jsx)(g,{style:{borderRadius:"50%",zIndex:15}})})});function A(){t(e+1);let n=new S(e,"Default Catchment");R(n),localStorage.setItem("currentCatchment",JSON.stringify(n))}async function K(){r(n+1);let e=new y(n,"Default Storm");v(e),localStorage.setItem("currentStorm",JSON.stringify(e));try{let e=await fetch("api/Users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"jasonTEst",password:"testpassword"})}),t=await e.text();console.log(t)}catch(e){throw Error("Problem with POST request")}}let G=P?{labels:P.finalRunoffTimeSeries,datasets:[{label:"Runoff Curve",data:P.finalRunoffIncremental}]}:null,J=P?{labels:["Runoff (m\xb3)","Losses (m\xb3)"],datasets:[{label:"Runoff Comparison (m\xb3)",data:[P.totalLosses,P.totalRunoff-P.totalLosses],backgroundColor:["rgb(255, 99, 132)","rgb(54, 162, 235)"],hoverOffset:4}]}:null;return(0,i.jsx)(u.LB,{id:"1",onDragEnd:function(e){let{over:t}=e,n=null;if(null===t&&"storm"===e.active.id.slice(0,5)){v(null);return}if(null===t&&"catchment"===e.active.id.slice(0,9)){R(null);return}"addStorm"===e.active.id?n=K:"addCatchment"===e.active.id&&(n=A),d(t?t.id:null),t&&n&&n()},onDragStart:function(e){p(!1)},children:(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",minHeight:"100vh",width:"100%"},onClick:function(e){"contextMenu"!==e.target.className&&k&&T(!1),console.log(e.target.className),"contextMenu edit"===e.target.className&&(p(!1),p(!0)),"contextMenu delete"===e.target.className&&(I===j?R(null):I===f&&v(null))},children:[(0,i.jsx)(c,{totals:[{catchments:e},{storms:n}],firstChild:L,secondChild:M}),(0,i.jsxs)("div",{onContextMenu:function(e){e.preventDefault(),p(!1),console.log(e.target.dataset.type),T(!1);let{over:t}=e;"storm"===e.target.dataset.type?(E(f),O({x:e.clientX,y:e.clientY}),T(!0)):"catchment"===e.target.dataset.type&&(E(j),O({x:e.clientX,y:e.clientY}),T(!0))},children:[(0,i.jsx)(b,{func:function(e){D(e)},currentStorm:f,currentCatchment:j,draggableCurrentStorm:f?(0,i.jsx)(o,{style:{borderRadius:"10%",boxShadow:"rgba(0, 0, 0, 0.25) 0px 14px 28px, rgba(0, 0, 0, 0.22) 0px 10px 10px"},children:(0,i.jsx)(h,{"data-type":"storm",id:"storm-"+f.id,children:(0,i.jsx)("div",{className:s().icon,"data-type":"storm",children:(0,i.jsx)(g,{"data-type":"storm",style:{borderRadius:"50%"}})})})}):null,id:"0",draggableCurrentCatchment:j?(0,i.jsx)(o,{style:{borderRadius:"10%",boxShadow:"rgba(0, 0, 0, 0.25) 0px 14px 28px, rgba(0, 0, 0, 0.22) 0px 10px 10px"},children:(0,i.jsx)(h,{"data-type":"catchment",id:"catchment-"+j.id,children:(0,i.jsx)("div",{className:s().icon,"data-type":"catchment",children:(0,i.jsx)(x,{"data-type":"catchment",style:{borderRadius:"50%"}})})})}):null}),k?(0,i.jsx)(N,{contextObject:I,mousePosition:F}):null]}),(0,i.jsxs)("div",{style:{backgroundColor:"var(--main-bg-color)",boxShadow:"rgba(0, 0, 0, 0.25) 0px 14px 28px, rgba(0, 0, 0, 0.22) 0px 10px 10px",height:"100vh",width:"20%",padding:"2rem",overflow:"auto",display:"flex",flexDirection:"column",rowGap:"4rem"},children:[P?(0,i.jsx)(w,{chartData:G,header:P.name}):(0,i.jsxs)("h4",{children:["Add a catchment and storm to get started. ",(0,i.jsx)("br",{})," ",(0,i.jsx)("br",{})]}),P?(0,i.jsx)(_,{chartData:J,header:P.name}):null,m?(0,i.jsx)(C,{editSubmission:function(){!function(){let e=document.querySelector("form").children;for(let t=0;t<e.length-1;t++)H.current[e[t].children[0].name]=e[t].children[0].value;console.log(H)}();let e=I.id;if(p(!1),I===f){let t=new y(e,H.current.name,H.current.timeData.split(",").map(e=>Number(e)),H.current.precipitationDataIntensity.split(",").map(e=>Number(e)));v(t),localStorage.setItem("currentStorm",JSON.stringify(t))}else if(I===j){let t=new S(e,H.current.name,Number(H.current.areaHectares),Number(H.current.imperviousPercent),Number(H.current.slopePercent),Number(H.current.curveNumber),Number(H.current.flowLength));R(t),localStorage.setItem("currentCatchment",JSON.stringify(t))}},editingObject:I}):null]})]})})}function P(e){let{totals:t,firstChild:n,secondChild:r}=e,[a,s]=(0,l.useState)(""),[o,c]=(0,l.useState)(""),[d,u]=(0,l.useState)(""),[h,m]=(0,l.useState)(""),p=async e=>{e.preventDefault();try{let e=await fetch("/api/Account/Register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({UserName:a,Email:o,Password:h,ConfirmPassword:h})}),t=await e.text();console.log(t)}catch(e){throw Error("Problem with POST request")}};return(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{children:"Sign up for Hydrosim"}),(0,i.jsxs)("form",{onSubmit:p,children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"username",children:"Username:"}),(0,i.jsx)("input",{type:"text",id:"username",value:a,onChange:e=>{s(e.target.value)}})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"email",children:"Email:"}),(0,i.jsx)("input",{type:"email",id:"email",value:o,onChange:e=>{c(e.target.value)}})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"confirmEmail",children:"Confirm Email:"}),(0,i.jsx)("input",{type:"email",id:"confirmEmail",value:d,onChange:e=>{u(e.target.value)}})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"password",children:"Password:"}),(0,i.jsx)("input",{type:"password",id:"password",value:h,onChange:e=>{m(e.target.value)}})]}),(0,i.jsx)("button",{type:"submit",children:"Register Account"})]})]})}function D(){let[e,t]=(0,l.useState)(!1),n=(0,i.jsx)(R,{}),r=(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:"display",children:(0,i.jsx)(P,{})})});return(0,i.jsx)("main",{className:s().main,children:e?n:r})}r.ZP.register(v.f$),r.ZP.register(v.uw)},345:function(e){e.exports={main:"page_main__GlU4n",display:"page_display__Qsd9Y","context-menu":"page_context-menu__Ax_XR",description:"page_description__86bsR",code:"page_code__9lUUd",icon:"page_icon__AYuK3",hydrographContainer:"page_hydrographContainer__9HsRc",catchmentSlot:"page_catchmentSlot__mzyiJ",stormSlot:"page_stormSlot__kaQWG",textSlot:"page_textSlot__1qIQa",center:"page_center__5oHG7","schematic-view":"page_schematic-view__Zx9ap",logo:"page_logo__7fc9l",card:"page_card__QV0Om",content:"page_content__kDoxQ",grid:"page_grid__f5Kdy",vercelLogo:"page_vercelLogo__rOY_u",rotate:"page_rotate__durgN"}}},function(e){e.O(0,[674,336,971,69,744],function(){return e(e.s=4627)}),_N_E=e.O()}]);