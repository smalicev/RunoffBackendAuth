(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4627:function(e,t,n){Promise.resolve().then(n.bind(n,197))},197:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return D}});var i=n(3827),a=n(3136),r=n(345),s=n.n(r),o=n(4090);function l(e){let[t,n]=(0,o.useState)(!1),a=t?{backgroundColor:"rgba(0, 255, 179, 0.216)",borderRadius:e.style?e.style.borderRadius:void 0,boxShadow:e.style?e.style.boxShadow:void 0}:void 0;return(0,i.jsx)("div",{onMouseEnter:function(){n(!0)},onMouseLeave:function(){n(!1)},style:a,children:e.children})}function c(e){let{Hydrographs:t}=e;return(0,i.jsxs)("div",{onClick:()=>{console.log(t)},children:[(0,i.jsx)("p",{children:"List is"}),t.map(e=>(0,i.jsx)("span",{children:e.Value},e.Value))]})}function d(e){let{totals:t,firstChild:n,secondChild:a,Hydrographs:r}=e,s={display:"flex",flexDirection:"column",rowGap:"1rem",justifyContent:"flex-start",height:"100vh",backgroundColor:"var(--main-bg-color)",padding:"2rem",boxShadow:"rgba(0, 0, 0, 0.25) 0px 14px 28px, rgba(0, 0, 0, 0.22) 0px 10px 10px",ul:{display:"flex",flexDirection:"column",listStyleType:"none",rowGap:"1rem"}};return(0,i.jsx)("div",{children:(0,i.jsxs)("nav",{style:s,children:[(0,i.jsx)("div",{className:"sidebar-name-container",children:(0,i.jsx)("h1",{children:"Catchment Runoff Calculator"})}),(0,i.jsxs)("ul",{style:s.ul,children:[(0,i.jsx)(l,{children:(0,i.jsx)("h3",{children:"Schematic View"})}),(0,i.jsx)(l,{children:(0,i.jsx)("h3",{children:"Documentation"})})]}),(0,i.jsx)("h4",{children:"Tools"}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"row",rowGap:"1rem",justifyContent:"space-around",padding:"1rem",borderTop:"2px solid rgba(92, 92, 92, 0.404)"},children:[n||null,a||null]}),(0,i.jsx)("h4",{children:"Previous Hydrographs"}),(0,i.jsx)(c,{Hydrographs:r})]})})}var u=n(703),h=n(7615);function m(e){let{attributes:t,listeners:n,setNodeRef:a,transform:r}=(0,h.O1)({id:e.id}),s=r?{transform:"translate3d(".concat(r.x,"px, ").concat(r.y,"px, 0)")}:void 0;return(0,i.jsx)("div",{ref:a,style:s,...n,...t,children:e.children})}var p={src:"/Dashboard/hydrosim/appl//_next/static/media/catchment.c866e452.svg",height:630,width:630,blurWidth:0,blurHeight:0};function x(e){let{style:t}=e;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(u.default,{"data-type":"catchment",src:p,height:100,width:100,alt:"A logo of an urban street with buildings and other infrastructure",style:t})})}var f={src:"/Dashboard/hydrosim/appl//_next/static/media/storm.c2b018f6.svg",height:630,width:630,blurWidth:0,blurHeight:0};function g(e){let{style:t}=e;return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(u.default,{"data-type":"storm",src:f,height:100,width:100,alt:"A logo of a cloud with rainfall",style:t})})}function y(e){let{isOver:t,setNodeRef:n}=(0,h.Zj)({id:e.id}),a=e.currentStorm,r=e.currentCatchment,o=e.draggableCurrentStorm,l=e.draggableCurrentCatchment;return(0,i.jsx)("div",{ref:n,style:{border:t?"0.25rem solid rgba(0, 0, 0, .05)":void 0,backgroundColor:t?"rgba(0, 0, 0, .3)":void 0,borderRadius:"1rem"},children:(0,i.jsxs)("div",{className:s().hydrographContainer,children:[(0,i.jsxs)("div",{className:s().catchmentSlot,children:[" ",l||(0,i.jsx)(x,{style:{opacity:.5,borderRadius:"50%",boxShadow:"0 0 10px 5px gray"}})]}),(0,i.jsxs)("div",{className:s().stormSlot,children:[" ",o||(0,i.jsx)(g,{style:{opacity:.5,border:"solid 1px gray",borderRadius:"50%",boxShadow:"0 0 10px 5px gray"}})]}),r&&a?(0,i.jsxs)("div",{className:s().textSlot,children:[a.name," on ",(0,i.jsx)("br",{})," the ",r.name," catchment."]}):(0,i.jsxs)("div",{className:s().textSlot,children:["Runoff Hydrograph ",(0,i.jsx)("br",{}),"  ",(0,i.jsx)("br",{})," Drag & drop both catchment and storm icons to get started!"]})]})})}class b{intensityToValues(e){let t=[];return e.forEach((e,n)=>{t.push(this.timeStep/60*e)}),t}constructor(e=null,t,n=[0,15,30,45,60,75,90,105,120,135,150,165,180],i=[5,8,12,55,74,112,78,56,55,32,4,2,1]){var a;let r;this.timeData=n,this.timeStep=n[1]-n[0],this.precipitationDataIntensity=i,this.precipitationData=this.intensityToValues(this.precipitationDataIntensity),this.cumulativePrecipitation=(a=this.precipitationData,r=[],a.forEach((e,t)=>{let n=0;for(let e=0;e<=t;e++)n+=a[e];r.push(n)}),r),this.name=t,this.id=e}}class j{constructor(e=null,t,n=1,i=30,a=1,r=85,s=40){this.name=t,this.areaHectares=n,this.imperviousPercent=i,this.slopePercent=a,this.curveNumber=r,this.sParameter=1e3/r+10,this.flowLength=s,this.roughnessCoeff=this.imperviousPercent<=20?.013:.25,this.timeToPeak=this.imperviousPercent<=20?null:this.kinematicWaveK,this.id=e}}var v=n(6136),S=n(1196);function w(e){let{chartData:t,header:n}=e;return(0,i.jsxs)("div",{className:"chart-container",children:[(0,i.jsxs)("h2",{style:{textAlign:"center"},children:[" ",n]}),(0,i.jsx)(S.x1,{data:t,options:{responsive:!0,scales:{x:{title:{display:!0,text:"Time (minutes)"}},y:{title:{display:!0,text:"Runoff (m\xb3/s)"},min:0}},plugins:{legend:{position:"top"},title:{display:!0,text:"Simulated hydrograph based on the current catchment and storm"}}}})]})}function _(e){let{chartData:t,header:n}=e;return(0,i.jsxs)("div",{className:"chart-container",children:[(0,i.jsxs)("h2",{style:{textAlign:"center"},children:[" ",n]}),(0,i.jsx)(S.by,{data:t,options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Total Volumetric Runoff (m\xb3)"}}}})]})}function C(e){let{editingObject:t,editSubmission:n}=e,a=t?Object.keys(t):null,r=t?Object.values(t):null,s=["cumulativePrecipitation","timeStep","roughnessCoeff","sParameter","timeToPeak","id","precipitationData"],o={precipitationDataIntensity:"Precipitation (intensity - mm/hr)",timeData:"Time series (minutes)",name:"Name or description",areaHectares:"Area (hectares)",imperviousPercent:"Percent Impervious (%)",slopePercent:"Slope Percent (%)",curveNumber:"SCS Curve Number",flowLength:"Flow length (m)"},l={fontSize:"1.25rem"};return(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",rowGap:"1rem",padding:"2rem",border:"2px solid rgba(92, 92, 92, 0.404)",boxShadow:"rgba(0, 0, 0, 0.25) 0px 14px 28px, rgba(0, 0, 0, 0.22) 0px 10px 10px"},className:"edit-menu",children:[(0,i.jsxs)("h2",{children:["Editing ",t.name]}),(0,i.jsxs)("form",{style:{display:"flex",flexDirection:"column",rowGap:"1rem",textAlign:"right",fontSize:"1.25rem"},children:[a.map((e,t)=>{if(!s.includes(e))return(0,i.jsxs)("label",{children:[o[e],": ",(0,i.jsx)("input",{style:l,name:e,defaultValue:r[t]},e)]},e)}),(0,i.jsx)("button",{style:{padding:"1rem",alignSelf:"right",fontSize:"1.5rem"},onClick:n,type:"button",children:" Submit Edits and Recalculate "})]})]})}function R(e){let{contextObject:t,mousePosition:n,editOnClick:a,deleteOnClick:r}=e,s={top:n.y,left:n.x,zIndex:10,position:"absolute",backgroundColor:"var(--main-bg-color)",padding:"0.5rem",fontSize:"1.5rem"},o={borderTop:"solid 1px rgba(92, 92, 92, 0.404)",borderBottom:"solid 1px rgba(92, 92, 92, 0.404)"};return t?(0,i.jsx)("div",{style:s,children:(0,i.jsxs)("ul",{style:{listStyleType:"none"},children:[(0,i.jsx)(l,{children:(0,i.jsxs)("li",{style:o,className:"contextMenu edit",children:["Edit ",t.name]})}),(0,i.jsx)(l,{children:(0,i.jsxs)("li",{style:o,className:"contextMenu delete",children:["Delete ",t.name]})})]})}):null}class P{valuesToIntensity(e){let t=[];return console.log(this.storm.cumulativePrecipitation),e.forEach((e,n)=>{t.push(e/(this.timeStep/60))}),t}calcKinematicWaveK(){let e=Math.max(...this.storm.precipitationDataIntensity);return console.log(e),this.catchment.flowLength**.6*this.catchment.roughnessCoeff**.6/(e**.4*(this.catchment.slopePercent/100)**.3)}scsLosses(e){let t=[],n=this.catchment.sParameter;return e.forEach((e,i)=>{t.push((e-.2*n)**2/(e+.8*n))}),t}linearIUH(){return{prePeakFlowFunc:e=>this.storm.timeStep/this.storm.timeStep*e,peakFlowFunc:e=>(e-Math.exp(-(this.storm.timeStep/this.kinematicWaveK)))/this.storm.timeStep,postPeakFlowFunc:(e,t)=>e*Math.exp(-(t-this.storm.timeStep)/this.kinematicWaveK)}}convolute(e){let t,n=[];return this.effectiveRunoff.forEach((t,i)=>{let a={},r=this.timeStep;a[this.timeStep*(i+1)]=e.peakFlowFunc(t);let s=0;for(console.log(e.peakFlowFunc(t)+"peak flow");e.postPeakFlowFunc(t,r)>.005&&s<1e3;)s++,a[r+this.timeStep*(i+1)]=e.postPeakFlowFunc(t,r+this.timeStep),r+=this.timeStep;n.push(a)}),console.log(n),t={},n.forEach((e,n)=>{for(let n in e)void 0===t[n]?t[n]=e[n]:t[n]+=e[n]}),t}generateTimeSeriesandIncRunoff(){for(let e in this.finalRunoffTimeSeries=[0],this.finalRunoffIncremental=[0],this.convolutions)this.finalRunoffTimeSeries.push(e),this.finalRunoffIncremental.push(this.convolutions[e]/100*this.catchment.areaHectares*1e4/(60*this.storm.timeStep))}constructor(e=null,t,n){this.timeStep=t.timeStep,this.timeToPeak=this.timeStep,this.storm=t,this.catchment=n,this.kinematicWaveK=this.calcKinematicWaveK(),this.effectiveRunoff=function(e){let t=[];for(let n=e.length-1;n>0;n--)t.push(e[n]-e[n-1]);return t.push(e[0]),t.reverse()}(this.scsLosses(this.storm.cumulativePrecipitation)),this.finalRunoffIncremental=null,this.finalRunoffTimeSeries=null,this.convolutions=this.convolute(this.linearIUH()),this.name="".concat(t.name," on ").concat(n.name),this.generateTimeSeriesandIncRunoff(),this.id=e,this.totalRunoff=this.storm.precipitationData.reduce((e,t)=>e+t)/1e3*(1e4*this.catchment.areaHectares),this.totalLosses=this.effectiveRunoff.reduce((e,t)=>e+t)/1e3*(1e4*this.catchment.areaHectares)}}function k(e){let{Id:t,Hydrographs:n}=e,[a,r]=(0,o.useState)(0),[c,u]=(0,o.useState)(0),[p,f]=(0,o.useState)(null),[v,S]=(0,o.useState)(!1),[k,N]=(0,o.useState)(null),[I,D]=(0,o.useState)(null),[T,E]=(0,o.useState)(null),[F,H]=(0,o.useState)(!1),[O,L]=(0,o.useState)(!1),[A,G]=(0,o.useState)({x:null,y:null}),[M,K]=(0,o.useState)(null);(0,o.useEffect)(()=>{async function e(e){await fetch("/api/hydrographs/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}async function n(){let e=await fetch("/api/hydrographs?userId=".concat(encodeURIComponent(t)),{method:"GET"});K(await e.json())}if(null!==I&&null!==k){let i=new P(0,k,I),a={Time:i.finalRunoffTimeSeries.toString(),Value:i.finalRunoffIncremental.toString(),userId:t};E(i);try{e(a)}catch(e){console.error("error:",e)}n()}},[I,k]);let U=(0,o.useRef)({}),z=(0,i.jsx)(m,{id:"addCatchment",children:(0,i.jsx)(l,{style:{borderRadius:"10%",boxShadow:"rgba(0, 0, 0, 0.25) 0px 14px 28px, rgba(0, 0, 0, 0.22) 0px 10px 10px"},children:(0,i.jsx)(x,{style:{borderRadius:"50%",zIndex:15}})})}),V=(0,i.jsx)(m,{id:"addStorm",children:(0,i.jsx)(l,{style:{borderRadius:"10%",boxShadow:"rgba(0, 0, 0, 0.25) 0px 14px 28px, rgba(0, 0, 0, 0.22) 0px 10px 10px"},children:(0,i.jsx)(g,{style:{borderRadius:"50%",zIndex:15}})})});function W(){r(a+1),D(new j(a,"Default Catchment"))}async function J(){u(c+1),N(new b(c,"Default Storm"))}let Q=T?{labels:T.finalRunoffTimeSeries,datasets:[{label:"Runoff Curve",data:T.finalRunoffIncremental}]}:null,Y=T?{labels:["Runoff (m\xb3)","Losses (m\xb3)"],datasets:[{label:"Runoff Comparison (m\xb3)",data:[T.totalLosses,T.totalRunoff-T.totalLosses],backgroundColor:["rgb(255, 99, 132)","rgb(54, 162, 235)"],hoverOffset:4}]}:null;return(0,i.jsx)(h.LB,{id:"1",onDragEnd:function(e){let{over:t}=e,n=null;if(null===t&&"storm"===e.active.id.slice(0,5)){N(null);return}if(null===t&&"catchment"===e.active.id.slice(0,9)){D(null);return}"addStorm"===e.active.id?n=J:"addCatchment"===e.active.id&&(n=W),f(t?t.id:null),t&&n&&n()},onDragStart:function(e){S(!1)},children:(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",minHeight:"100vh",width:"100%"},onClick:function(e){"contextMenu"!==e.target.className&&F&&H(!1),console.log(e.target.className),"contextMenu edit"===e.target.className&&(S(!1),S(!0)),"contextMenu delete"===e.target.className&&(O===I?D(null):O===k&&N(null))},children:[(0,i.jsx)(d,{totals:[{catchments:a},{storms:c}],firstChild:z,secondChild:V,Hydrographs:M||n||[]}),(0,i.jsxs)("div",{onContextMenu:function(e){e.preventDefault(),S(!1),console.log(e.target.dataset.type),H(!1);let{over:t}=e;"storm"===e.target.dataset.type?(L(k),G({x:e.clientX,y:e.clientY}),H(!0)):"catchment"===e.target.dataset.type&&(L(I),G({x:e.clientX,y:e.clientY}),H(!0))},children:[(0,i.jsx)(y,{currentStorm:k,currentCatchment:I,draggableCurrentStorm:k?(0,i.jsx)(l,{style:{borderRadius:"10%",boxShadow:"rgba(0, 0, 0, 0.25) 0px 14px 28px, rgba(0, 0, 0, 0.22) 0px 10px 10px"},children:(0,i.jsx)(m,{"data-type":"storm",id:"storm-"+k.id,children:(0,i.jsx)("div",{className:s().icon,"data-type":"storm",children:(0,i.jsx)(g,{"data-type":"storm",style:{borderRadius:"50%"}})})})}):null,id:"0",draggableCurrentCatchment:I?(0,i.jsx)(l,{style:{borderRadius:"10%",boxShadow:"rgba(0, 0, 0, 0.25) 0px 14px 28px, rgba(0, 0, 0, 0.22) 0px 10px 10px"},children:(0,i.jsx)(m,{"data-type":"catchment",id:"catchment-"+I.id,children:(0,i.jsx)("div",{className:s().icon,"data-type":"catchment",children:(0,i.jsx)(x,{"data-type":"catchment",style:{borderRadius:"50%"}})})})}):null}),F?(0,i.jsx)(R,{contextObject:O,mousePosition:A}):null]}),(0,i.jsxs)("div",{style:{backgroundColor:"var(--main-bg-color)",boxShadow:"rgba(0, 0, 0, 0.25) 0px 14px 28px, rgba(0, 0, 0, 0.22) 0px 10px 10px",height:"100vh",width:"20%",padding:"2rem",overflow:"auto",display:"flex",flexDirection:"column",rowGap:"4rem"},children:[T?(0,i.jsx)(w,{chartData:Q,header:T.name}):(0,i.jsxs)("h4",{children:["Add a catchment and storm to get started. ",(0,i.jsx)("br",{})," ",(0,i.jsx)("br",{})]}),T?(0,i.jsx)(_,{chartData:Y,header:T.name}):null,v?(0,i.jsx)(C,{editSubmission:function(){!function(){let e=document.querySelector("form").children;for(let t=0;t<e.length-1;t++)U.current[e[t].children[0].name]=e[t].children[0].value;console.log(U)}();let e=O.id;if(S(!1),O===k){let t=new b(e,U.current.name,U.current.timeData.split(",").map(e=>Number(e)),U.current.precipitationDataIntensity.split(",").map(e=>Number(e)));N(t),localStorage.setItem("currentStorm",JSON.stringify(t))}else if(O===I){let t=new j(e,U.current.name,Number(U.current.areaHectares),Number(U.current.imperviousPercent),Number(U.current.slopePercent),Number(U.current.curveNumber),Number(U.current.flowLength));D(t),localStorage.setItem("currentCatchment",JSON.stringify(t))}},editingObject:O}):null]})]})})}function N(){let[e,t]=(0,o.useState)(""),[n,a]=(0,o.useState)(""),[r,s]=(0,o.useState)(!1),l=async t=>{t.preventDefault(),fetch("/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"grant_type=password&username=".concat(encodeURIComponent(e),"&password=").concat(encodeURIComponent(n))}).then(e=>e.json()).then(e=>{console.log("Token:",e.access_token),localStorage.setItem("access_token",e.access_token)}).catch(e=>console.error("Error:",e))},c=(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h2",{children:"Sign up for Hydrosim"}),(0,i.jsxs)("form",{onSubmit:l,children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"email",children:"Email:"}),(0,i.jsx)("input",{type:"email",id:"email",value:e,onChange:e=>{t(e.target.value)}})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"password",children:"Password:"}),(0,i.jsx)("input",{type:"password",id:"password",value:n,onChange:e=>{a(e.target.value)}})]}),(0,i.jsx)("button",{type:"submit",children:"Log in"})]}),(0,i.jsxs)("h2",{children:["Don&apost have an account?",(0,i.jsx)("a",{onClick:()=>{s(!0)},children:"Sign up here."})]})]});return(0,i.jsx)("div",{children:r?(0,i.jsx)(I,{}):c})}function I(e){let{totals:t,firstChild:n,secondChild:a}=e,[r,s]=(0,o.useState)(""),[l,c]=(0,o.useState)(""),[d,u]=(0,o.useState)(""),[h,m]=(0,o.useState)(""),[p,x]=(0,o.useState)(!1),f=async e=>{e.preventDefault(),l!==r&&alert("Emails do not match!");try{let e=await fetch("/api/Account/Register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Email:r,Password:h,ConfirmPassword:d})}),t=await e.text();console.log(t),x(!0)}catch(e){throw Error("Problem with request")}},g=(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{children:"Sign up for Hydrosim"}),(0,i.jsxs)("form",{onSubmit:f,children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"email",children:"Email:"}),(0,i.jsx)("input",{type:"email",id:"email",value:r,onChange:e=>{s(e.target.value)}})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"confirmEmail",children:"Confirm Email:"}),(0,i.jsx)("input",{type:"email",id:"confirmEmail",value:l,onChange:e=>{c(e.target.value)}})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"password",children:"Password:"}),(0,i.jsx)("input",{type:"password",id:"password",value:h,onChange:e=>{m(e.target.value)}})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"confirmPassword",children:"Confirm Password:"}),(0,i.jsx)("input",{type:"password",id:"confirmPassword",value:d,onChange:e=>{u(e.target.value)}})]}),(0,i.jsx)("button",{type:"submit",children:"Register Account"})]})]});return(0,i.jsx)(i.Fragment,{children:p?(0,i.jsx)(N,{}):g})}function D(){let[e,t]=(0,o.useState)(!1),[n,a]=(0,o.useState)(null),[r,l]=(0,o.useState)(null),[c,d]=(0,o.useState)(null),u=async()=>{let e=localStorage.getItem("access_token");if(t(!0),null!==e){let t=await fetch("/api/Account/UserInfo",{method:"GET",headers:{Authorization:"Bearer ".concat(e)}}),n=await t.json();l(n);let i=await fetch("/api/hydrographs?userId=".concat(encodeURIComponent(n.Id)),{method:"GET"});d(await i.json())}};return(0,o.useEffect)(()=>{u()},[]),(0,i.jsx)("main",{className:s().main,children:e?r?(0,i.jsx)(k,{Id:r.Id,Hydrographs:c}):(0,i.jsx)(k,{}):(0,i.jsx)(N,{})})}a.ZP.register(v.f$),a.ZP.register(v.uw)},345:function(e){e.exports={main:"page_main__GlU4n",display:"page_display__Qsd9Y","context-menu":"page_context-menu__Ax_XR",description:"page_description__86bsR",code:"page_code__9lUUd",icon:"page_icon__AYuK3",hydrographContainer:"page_hydrographContainer__9HsRc",catchmentSlot:"page_catchmentSlot__mzyiJ",stormSlot:"page_stormSlot__kaQWG",textSlot:"page_textSlot__1qIQa",center:"page_center__5oHG7","schematic-view":"page_schematic-view__Zx9ap",logo:"page_logo__7fc9l",card:"page_card__QV0Om",content:"page_content__kDoxQ",grid:"page_grid__f5Kdy",vercelLogo:"page_vercelLogo__rOY_u",rotate:"page_rotate__durgN"}}},function(e){e.O(0,[674,336,971,69,744],function(){return e(e.s=4627)}),_N_E=e.O()}]);